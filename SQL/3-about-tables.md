# é—œæ–¼è¨­è¨ˆ Table?
è¨­è¨ˆè³‡æ–™åº«æ™‚ï¼Œæˆ‘å€‘æ‡‰è€ƒæ…®ä»¥ä¸‹ä¸‰å€‹é—œéµåŸå‰‡ï¼š
1. æ¨™æº–åŒ–åŠŸèƒ½æ¨¡çµ„ï¼š
å¸¸è¦‹åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼šèªè­‰ã€ç•™è¨€ç­‰ï¼‰é€šå¸¸å…·æœ‰å‚³çµ±çš„è³‡æ–™è¡¨åç¨±åŠæ¬„ä½è¨­è¨ˆã€‚
é€™äº›åç¨±èˆ‡çµæ§‹æœ‰åŠ©æ–¼ä¿æŒä¸€è‡´æ€§ï¼Œä¸¦ä¾¿æ–¼æœªä¾†æ“´å……æˆ–ç¶­è­·ã€‚

2. è³‡æºè­˜åˆ¥èˆ‡å€éš”ï¼š
é¦–å…ˆè­˜åˆ¥æ‡‰ç”¨ç¨‹å¼ä¸­çš„å„é …è³‡æºï¼Œä¸¦ç‚ºæ¯å€‹è³‡æºå»ºç«‹å–®ç¨çš„è³‡æ–™è¡¨ã€‚
ä¾‹å¦‚ï¼šusersã€photosã€commentsã€likes ç­‰ã€‚

1. é—œè¯æ€§ï¼š
å¦‚æœå…©å€‹è³‡æºä¹‹é–“å­˜åœ¨æ“æœ‰é—œä¿‚æˆ–é—œè¯æ€§ï¼Œå‰‡éœ€åœ¨è³‡æ–™è¡¨è¨­è¨ˆä¸­é€²è¡Œåæ˜ ã€‚
ä¾‹å¦‚ï¼š
* photos èˆ‡ users ä¹‹é–“çš„é—œè¯ï¼ˆèª°ä¸Šå‚³äº†é€™å¼µç…§ç‰‡ï¼‰
* comments èˆ‡ photos ä¹‹é–“çš„é—œè¯ï¼ˆé‡å°å“ªå¼µç…§ç‰‡é€²è¡Œç•™è¨€ï¼‰

## Table é—œä¿‚ (Relationship) æ¦‚å¿µèªªæ˜
1.	ä¸€å°ä¸€ (One to One)
	* æ¯ç­†è³‡æ–™åƒ…å°æ‡‰å¦ä¸€å€‹ Table ä¸­çš„ä¸€ç­†è³‡æ–™ã€‚
	* ç¯„ä¾‹ï¼š æ¯å€‹äººåƒ…æœ‰ä¸€æœ¬è­·ç…§ï¼Œæ¯æœ¬è­·ç…§åƒ…å°æ‡‰ä¸€ä½æŒæœ‰äººã€‚
2.	ä¸€å°å¤š (One to Many)
	* ä¸€ç­†è³‡æ–™å¯å°æ‡‰åˆ°å¦ä¸€å€‹ Table ä¸­çš„å¤šç­†è³‡æ–™ã€‚
	* ç¯„ä¾‹ï¼š ä¸€ä½çˆ¶è¦ªå¯æ“æœ‰å¤šå€‹å­©å­ï¼Œä½†æ¯å€‹å­©å­åƒ…å°æ‡‰ä¸€ä½çˆ¶è¦ªã€‚
3.	å¤šå°å¤š (Many to Many)
	* ä¸€ç­†è³‡æ–™å¯å°æ‡‰åˆ°å¦ä¸€å€‹ Table ä¸­çš„å¤šç­†è³‡æ–™ï¼Œä¸”é›™æ–¹çš†å¯å°æ‡‰å¤šç­†è³‡æ–™ã€‚
	* ç¯„ä¾‹ï¼š ä¸€åå­¸ç”Ÿå¯é¸ä¿®å¤šé–€èª²ç¨‹ï¼Œè€Œæ¯é–€èª²ç¨‹ä¹Ÿå¯åŒ…å«å¤šåå­¸ç”Ÿã€‚

## Primary Key èˆ‡ Foreign Key çš„æ¦‚å¿µ

* Primary Key (pk)ï¼š
    * ç”¨æ–¼å”¯ä¸€æ¨™è­˜ Table ä¸­çš„æ¯ç­†è³‡æ–™ï¼Œå¿…é ˆç‚ºå”¯ä¸€ä¸”ä¸é‡è¤‡çš„å€¼ã€‚
* Foreign Key (fk)ï¼š
    * ç”¨æ–¼å»ºç«‹è³‡æ–™ä¹‹é–“çš„é—œè¯ï¼ŒæŒ‡å‘å¦ä¸€å€‹ Table çš„ Primary Key æ¬„ä½ï¼Œä»¥ä¾¿æ–¼æŸ¥æ‰¾ç›¸é—œè³‡æ–™ã€‚

ä¸‹æ–¹å…©å€‹ Table çš„è¨­è¨ˆå±•ç¤ºäº† Primary Key èˆ‡ Foreign Key çš„æ‡‰ç”¨ï¼š
1. åœ¨ã€Œç…§ç‰‡è³‡è¨Š Tableã€ä¸­ï¼š
  * id æ¬„ä½æ˜¯ Primary Keyï¼Œç”¨æ–¼å”¯ä¸€æ¨™è­˜æ¯å¼µç…§ç‰‡ã€‚
	* user_id æ¬„ä½ï¼šForeign Keyï¼Œå°æ‡‰åˆ°ã€Œä½¿ç”¨è€…è³‡è¨Š Tableã€çš„ id æ¬„ä½ï¼Œç”¨æ–¼å»ºç«‹å…©è€…ä¹‹é–“çš„é—œè¯ã€‚
2. åœ¨ã€Œä½¿ç”¨è€…è³‡è¨Š Tableã€ä¸­ï¼š
	* id æ¬„ä½ï¼šPrimary Keyï¼Œå”¯ä¸€æ¨™è­˜æ¯ä½ä½¿ç”¨è€…ã€‚

### ğŸ“¸ ç…§ç‰‡è³‡è¨Š Table
| id  | url                                | user_id |
|-----|------------------------------------|---------|
| 1   | https://example.com/image1.png     | 4     |
| 2   | https://example.com/image2.jpg     | 4     |
| 3   | https://example.com/image3.gif     | 1     |
| 4   | https://example.com/image4.webp    | 2     |

### ğŸ‘¤ ä½¿ç”¨è€…è³‡è¨Š Table
| id  | userName   | email                |
|-----|------------|----------------------|
| 1   | johndoe    | johndoe@example.com  |
| 2   | janesmith  | janesmith@example.com|
| 3   | alex_lee   | alex.lee@example.com |
| 4   | emilywang  | emily.wang@example.com |

é—œè¯æ€§èªªæ˜ï¼š
* ç…§ç‰‡ image1.png å’Œ image2.jpg çš„ user_id ç‚º 4ï¼Œå°æ‡‰ä½¿ç”¨è€… emilywangã€‚
* ç…§ç‰‡ image3.gif çš„ user_id ç‚º 1ï¼Œå°æ‡‰ä½¿ç”¨è€… johndoeã€‚

å¦‚æ­¤ä¸€ä¾†ï¼Œé€é Foreign Key (user_id)ï¼Œæˆ‘å€‘å¯ä»¥è¼•æ˜“è¿½è¹¤æ¯å¼µç…§ç‰‡æ‰€å±¬çš„ä½¿ç”¨è€…ï¼Œå»ºç«‹è³‡æ–™é–“çš„é—œè¯æ€§ã€‚


#### **Primary Keys vs Foreign Keys æ¯”è¼ƒ**

| ç‰¹æ€§         | **Primary Keys**              | **Foreign Keys**                  |
|--------------|------------------------------------|---------------------------------------|
| **å®šç¾©**      | æ¯å€‹è³‡æ–™è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½æœ‰å”¯ä¸€çš„ pk  | å¦‚æœä¸€ç­†è³‡æ–™å±¬æ–¼å¦ä¸€ç­†è³‡æ–™ï¼Œå‰‡è©²ç­†è³‡æ–™æœƒæ“æœ‰ fk |
| **å”¯ä¸€æ€§**    | åŒä¸€è³‡æ–™è¡¨ä¸­ï¼Œ pk çš„å€¼å¿…é ˆå”¯ä¸€      | åŒä¸€è³‡æ–™è¡¨ä¸­ï¼Œå¯ä»¥æœ‰å¤šç­†è³‡æ–™æ“æœ‰ç›¸åŒçš„ fk |
| **åç¨±**      | 99% çš„æƒ…æ³ä¸‹ç¨±ç‚º `id`               | åç¨±å¯è®Šï¼Œé€šå¸¸ç‚º `xxx_id`                |
| **æ•¸æ“šé¡å‹**  | é€šå¸¸ç‚º `integer` æˆ– `uuid`          | èˆ‡æ‰€åƒç…§è³‡æ–™çš„ pk é¡å‹ç›¸åŒ                |
| **æ•¸æ“šè®Šå‹•**  |  pk ä¸€æ—¦å»ºç«‹ï¼Œä¸æœƒæ”¹è®Š              | è‹¥é—œè¯å°è±¡æ”¹è®Šï¼Œå‰‡ fk å¯èƒ½éš¨ä¹‹è®Šå‹•         |


## Understanding Foreign Keys
åœ¨ SQL ä¸­ï¼Œ**Foreign Keys** æ˜¯ç”¨ä¾†ç¶­è­·è³‡æ–™å®Œæ•´æ€§çš„é‡è¦æ¦‚å¿µã€‚å®ƒç”¨æ–¼å»ºç«‹ä¸€å€‹è³‡æ–™è¡¨èˆ‡å¦ä¸€å€‹è³‡æ–™è¡¨ä¹‹é–“çš„é—œè¯ã€‚

> åœ¨è³‡æ–™åº«è¨­è¨ˆä¸­ï¼Œç•¶æˆ‘å€‘è™•ç† ä¸€å°å¤š (One-to-Many) æˆ– å¤šå°å¤š (Many-to-Many) é—œè¯æ™‚ï¼Œã€Œå¤šæ–¹ (Many)ã€çš„ Table é€šå¸¸æœƒæ“æœ‰ Foreign Key æ¬„ä½ï¼Œä»¥å»ºç«‹èˆ‡å¦ä¸€å€‹ Table (é€šå¸¸æ˜¯ã€Œä¸€æ–¹ã€) çš„é€£çµã€‚ 

### ä»¥ Instagram ç‚ºä¾‹

åœ¨ Instagram çš„è³‡æ–™åº«è¨­è¨ˆä¸­ï¼Œæˆ‘å€‘å¯èƒ½æœƒå»ºç«‹ usersï¼ˆä½¿ç”¨è€…ï¼‰ã€photosï¼ˆç…§ç‰‡ï¼‰å’Œ commentsï¼ˆè©•è«–ï¼‰ ä¸‰å€‹è³‡æ–™è¡¨ã€‚
ä»¥ä¸‹æ˜¯å®ƒå€‘çš„é—œè¯æ€§ï¼š
* photos è¡¨ä¸­çš„ user_id æ˜¯ Foreign Keyï¼Œå°æ‡‰ users è¡¨ä¸­çš„ id æ¬„ä½ã€‚
* comments è¡¨ä¸­çš„ user_id å’Œ photo_id çš†ç‚º Foreign Keyï¼Œåˆ†åˆ¥å°æ‡‰ users å’Œ photos è¡¨ä¸­çš„ Primary Key æ¬„ä½ (id)ã€‚

é—œè¯é—œä¿‚åœ–ç¤ºï¼š
```
+---------------+   +--------------+   +---------------+
|               |   |              |   |               |
|     users     |   |    photos    |   |   comments    |
|               |   |              |   |               |
+---------------+   +--------------+   +---------------+
| id (PK)       |   | id (PK)      |   | id (PK)       |
| username      |   | url          |   | contents      |
| email         |   | user_id (FK) |   | user_id (FK)  |
|               |   |              |   | photo_id (FK) |
+---------------+   +--------------+   +---------------+
```


### **ğŸ“ Comments Table**

| id  | text                | user_id | photo_id |
|-----|---------------------|---------|----------|
| 1   | Nice shot!          | 1       | 2        |
| 2   | Love this photo!    | 2       | 1        |
| 3   | Amazing colors      | 3       | 3        |
| 4   | Where was this?     | 1       | 4        |

* user_id: æŒ‡å‘ users è¡¨ä¸­çš„ id æ¬„ä½ï¼Œä»¥æ¨™ç¤ºè©•è«–çš„ç™¼ä½ˆè€…ã€‚
* photo_id: æŒ‡å‘ photos è¡¨ä¸­çš„ id æ¬„ä½ï¼Œä»¥æ¨™ç¤ºè©•è«–æ‰€å±¬çš„ç…§ç‰‡ã€‚

---

### **ğŸ“· Photos Table**

| id  | url                          | user_id |
|-----|------------------------------|---------|
| 1   | https://example.com/img1.jpg | 1       |
| 2   | https://example.com/img2.jpg | 2       |
| 3   | https://example.com/img3.jpg | 3       |
| 4   | https://example.com/img4.jpg | 1       |

* user_id: æŒ‡å‘ users è¡¨ä¸­çš„ id æ¬„ä½ï¼Œä»¥æ¨™ç¤ºç…§ç‰‡çš„ä¸Šå‚³è€…ã€‚


---

### **ğŸ‘¤ Users Table**

| id  | username   | email               |
|-----|------------|---------------------|
| 1   | alice      | alice@example.com   |
| 2   | bob        | bob@example.com     |
| 3   | charlie    | charlie@example.com |
| 4   | dave       | dave@example.com    |

* id: Primary Keyï¼Œå”¯ä¸€æ¨™è­˜æ¯å€‹ç”¨æˆ¶ã€‚


# è‡ªå‹•ç”¢ç”Ÿ IDï¼ˆPrimary Key èˆ‡ Foreign Keyï¼‰

åœ¨ PostgreSQL ä¸­ï¼Œ`SERIAL` æ˜¯ä¸€ç¨®è‡ªå‹•ç”Ÿæˆçš„æ•´æ•¸å‹åˆ¥ï¼Œç”¨æ–¼å»ºç«‹è‡ªå‹•éå¢çš„ Primary Keyã€‚  
åœ¨ Foreign Key ä¸­ï¼Œæˆ‘å€‘é€é `REFERENCES` é—œéµå­—ä¾†å»ºç«‹è³‡æ–™è¡¨ä¹‹é–“çš„é—œè¯ã€‚

---

## **å»ºç«‹ Users è³‡æ–™è¡¨ä¸¦ç”¢ç”Ÿè‡ªå‹•éå¢çš„ Primary Key**

```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  username VARCHAR(50)
);
```
## âœ… èªæ³•èªªæ˜ï¼š
* SERIALï¼š è‡ªå‹•ç”Ÿæˆéå¢æ•´æ•¸ (1, 2, 3, ...) ä¸¦è¨­å®šç‚º Primary Keyã€‚
* PRIMARY KEYï¼š ç¢ºä¿ id æ¬„ä½çš„å€¼æ˜¯å”¯ä¸€ä¸”ä¸å¯ç‚ºç©ºã€‚
---

## æ’å…¥ Users è³‡æ–™

```sql
INSERT INTO
  users (username)
VALUES
  ('Alice'),
  ('Stevie'),
  ('Jonathan'),
  ('Harry')
```

### âœ… èªæ³•èªªæ˜ï¼š
* æˆ‘å€‘åƒ…æ’å…¥ username æ¬„ä½ï¼Œid æ¬„ä½å°‡è‡ªå‹•ç”Ÿæˆéå¢å€¼ã€‚
* æ’å…¥å¾Œï¼Œid æ¬„ä½çš„å€¼å°‡ä¾åºç‚ºï¼š1, 2, 3, 4ã€‚

---

## **å»ºç«‹ Photos è³‡æ–™è¡¨ä¸¦å»ºç«‹ Foreign Keys é—œè¯**

```sql
CREATE TABLE photos (
  id SERIAL PRIMARY KEY,
  url VARCHAR(200),
  user_id INTEGER REFERENCES users(id)
);
```

### âœ… èªæ³•èªªæ˜ï¼š
* *id SERIAL PRIMARY KEYï¼š æ¯å¼µç…§ç‰‡å°‡æ“æœ‰å”¯ä¸€çš„è‡ªå‹•éå¢ idã€‚
* *user_id INTEGERï¼š å°‡ user_id æ¬„ä½è¨­ç‚ºæ•´æ•¸ï¼Œç”¨æ–¼åƒç…§ users è³‡æ–™è¡¨ä¸­çš„ id æ¬„ä½ã€‚
* *REFERENCES users(id)ï¼š
* *å»ºç«‹ user_id èˆ‡ users è¡¨ä¸­çš„ id æ¬„ä½ä¹‹é–“çš„é—œè¯ã€‚
* *ç¢ºä¿ user_id çš„å€¼å¿…é ˆå°æ‡‰åˆ° users è¡¨ä¸­çš„æœ‰æ•ˆ id å€¼ã€‚

---

## æ’å…¥ Photos è³‡æ–™

```sql
INSERT INTO
  photos (url, user_id)
VALUES
  ('http://example.test1.jpg', 4),
  ('http://example.test2.jpg', 2),
  ('http://example.test3.jpg', 1),
  ('http://example.test4.jpg', 3),
  ('http://example.test5.jpg', 4),
  ('http://example.test6.jpg', 1),
  ('http://example.test7.jpg', 3);
```

### âœ… èªæ³•èªªæ˜ï¼š
* id æ¬„ä½å°‡è‡ªå‹•ç”Ÿæˆä¸¦éå¢ (1, 2, 3, ...)ã€‚
* user_id æ¬„ä½å¿…é ˆå°æ‡‰åˆ° users è¡¨ä¸­çš„ id å€¼ï¼Œå¦å‰‡æ’å…¥å°‡å¤±æ•—ã€‚

---

## æŸ¥è©¢ï¼šæ‰¾åˆ° user_id = 4 çš„æ‰€æœ‰ç…§ç‰‡

```sql
SELECT
  *
FROM
  photos
WHERE
  user_id = 4;
```

### âœ… èªæ³•èªªæ˜ï¼š
* æˆ‘å€‘åœ¨ photos è¡¨ä¸­æŸ¥è©¢ user_id ç‚º 4 çš„æ‰€æœ‰ç…§ç‰‡ã€‚
* æ­¤æŸ¥è©¢å°‡è¿”å› Harry ä¸Šå‚³çš„æ‰€æœ‰ç…§ç‰‡

---

## æŸ¥è©¢ï¼šåˆ—å‡ºæ‰€æœ‰ç…§ç‰‡ä¸¦é¡¯ç¤ºé—œè¯ç”¨æˆ¶çš„è³‡è¨Š

```sql
SELECT
  url,
  username
FROM
  photos
  JOIN users ON user.id = photo.user_id;
```

### âœ… èªæ³•èªªæ˜ï¼š
* JOIN é—œéµå­—ï¼š å°‡ photos è¡¨ä¸­çš„ user_id èˆ‡ users è¡¨ä¸­çš„ id é€²è¡Œé€£æ¥ï¼Œä»¥é¡¯ç¤ºç…§ç‰‡èˆ‡ä¸Šå‚³è€…çš„å°æ‡‰é—œä¿‚ã€‚
* çµæœï¼š æ¯å¼µç…§ç‰‡å°‡é¡¯ç¤ºå…¶ url åŠå°æ‡‰çš„ usernameã€‚