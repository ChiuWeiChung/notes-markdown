# 傳輸協定簡介

> 嗨！我寫這篇筆記主要是想幫自己搞清楚那些常聽到的通訊協定（TCP、UDP之類的）到底是什麼，還有了解一下影片串流的技術究竟有哪些實現方式。透過動手做幾個簡單的實驗和比較不同方法，希望能更直觀地理解這些技術的優缺點，以及它們適合哪些使用場景。這些知識對我未來開發相關專案肯定會很有幫助！

## TCP (Transmission Control Protocol)
- **基於連接**  
  - 傳送前，必須經過「三次握手」建立連線，確保雙方準備就緒。  
  - 傳送者完全知道接收者的連線狀況。
- **可靠性**  
  - 若出現遺失或錯誤，會自動重傳，直到正確送達或超時。  
  - 能保證資料有序且完整地抵達。
- **範例**  
  - 「掛號附回執聯寄信」，信件送達後能收到通知；如果沒收到通知，就可以再傳一次。


## UDP (User Datagram Protocol)
- **無連接式**  
  - 送資料前不需要事先與接收端「握手」，不知道對方是否就緒。  
  - 傳送者只要知道對方位址，就直接把資料包（Datagram）丟出去。
- **較不可靠**  
  - 資料可能丟失或重複，且無機制保證送達。  
  - 不會因傳輸錯誤自動重傳。
- **範例**  
  - 「貼標準郵票寄信」，不知道信是否到達；只能期待它能順利寄達。

---

## 對照小結

| 協定 | 連接模式        | 傳輸可靠性 | 適用場景                         | 類比              |
|:---:|:------------:|:------:|:---------------------------:|:----------------:|
| UDP | 無連接式        | 不可靠    | 即時影音串流、即時遊戲、VoIP 等   | 標準郵票寄信        |
| TCP | 有連接、握手機制 | 可靠      | HTTP、FTP、檔案傳輸、Web 服務等   | 掛號附回執聯寄信     |



## 範例 1: 本機 Webcam → UDP → 本機媒體播放器

[我的 Github 實作](https://github.com/ChiuWeiChung/live-streaming/tree/feature/udp-local-video)
``` 
 ______________
||            ||                        .--. 
||            ||                        |__| .-------.  
||____________||                        |=.| |.-----.|
|______________|                        |--| ||     ||  
 \\############\\                       |  | |'-----'| 
  \      ____    \                      |__|~')_____('
   \_____\___\____\               ┌─────────────────────────────┐
┌──────────────┐       (UDP)      │        Local Machine        │
│ Local Webcam │ ───────────────> │        (Media Player)       │
└──────────────┘                  └─────────────────────────────┘
                                 

```

## 範例 2: Ubuntu (BigBuckBunny.mp4)  → UDP → 本機媒體播放器
[我的 Github 實作](https://github.com/ChiuWeiChung/live-streaming/tree/feature/udp-webcam)
``` 
          .---.                         ______________       
         /     \                       ||            ||     
         \.@-@./                       ||            ||      
         /`\_/`\                       ||____________||       
        //  _  \\                      |______________|     
       | \     )|_                      \\############\\      
      /`\_`>  <_/ \                      \      ____    \    
      \__/'---'\__/                       \_____\___\____\  
┌──────────────────────┐  (UDP)         ┌──────────────────┐
│    (Docker: Ubuntu)  │ ─────────────> │   Local Machine  │
│ Big Buck Bunny (mp4) │                │  (Media Player)  │
└──────────────────────┘                └──────────────────┘
```


## UDP 串流特性重點
1. 低延遲：
    * UDP 相比 TCP 更能降低傳輸延遲。
    * 適用於要求「即時回饋」或「近即時」串流的場合（例如現場直播、視訊通話、即時監控）。
2. 可能發生掉幀（丟包）：
    * 由於 UDP 不保證資料到達率，一旦網路狀況不佳或無法及時處理，可能導致畫面延遲、馬賽克，甚至播放端掉幀。
    ```
    ┌─────────┐                       ┌─────────────┐                      ┌─────────┐
    │  Client │                       │   Network   │                      │ Server  │
    └─────────┘                       └─────────────┘                      └─────────┘
        |                                  |                                   |
        |  1) packet #1   ─────────────────┼─────────────────────────────────> |
        |  2) packet #2   ─────────────────┼─────────────────X                 |
        |  3) packet #3   ─────────────────┼─────────────────────────────────> |
        |  4) packet #4   ─────────────────┼─────────────────────────────────> |
        |                                  |                                   |
        ↓                                  ↓                                   ↓
        (發送完)                           (網路雜訊/阻塞/遺失等)              (只收到封包1,3,4)
    ```
1. 一對一的限制：
    * 基本上，UDP 推流在這些簡單範例裡主要適用「單一發送端 → 單一接收端」的模式。
    * 如果同時有多個接收端，需要額外機制（例如在網路層建立 multicast，或使用專門的媒體伺服器）才能推送給多位 user。


## 範例 3: 本機 Webcam → RTMP → RTMP Server → RTMP → 本機 MPV

> 補充說明：MPV 是一款免費、開源、跨平台的媒體播放器，支援多種影音格式和串流協定。

[我的 Github 實作](https://github.com/ChiuWeiChung/live-streaming/tree/feature/rtmp-webcam)

``` ______________                           .---.     
||      *     ||                         /     \        
||            ||                         \.@-@./    
||____________||                         /`\_/`\    
|______________|                        //  _  \\   
 \\############\\                      | \     )|_  
  \      ____    \                    /`\_`>  <_/ \ 
   \_____\___\____\                   \__/'---'\__/ 
┌───────────────────┐   (RTMP)   ┌───────────────────────┐
│    Local Webcam   │ ─────────> │ (Docker: RTMP Server) │
└───────────────────┘            └───────────────────────┘
                                            │
                                            │ 
                                            │(RTMP)
                                            │         .--.
                                            v         |__| .-------.
                                  ┌──────────────────┐|=.| |.-----.|
                                  │ Local Machine    │|--| ||     ||
                                  │     (MPV)        │|  | |'-----'|
                                  └──────────────────┘|__|~')_____('
```
                  
## 範例 4: Ubuntu(BigBuckBunny.mp4) → RTMP → 本機 MPV

[我的 Github 實作](https://github.com/ChiuWeiChung/live-streaming/tree/feature/rtmp-local-video)

``` 
          .---.                         ______________       
         /     \                       ||            ||     
         \.@-@./                       ||            ||      
         /`\_/`\                       ||____________||       
        //  _  \\                      |______________|     
       | \     )|_                      \\############\\      
      /`\_`>  <_/ \                      \      ____    \    
      \__/'---'\__/                       \_____\___\____\  
┌──────────────────────┐  (RTMP)        ┌──────────────────┐
│    (Docker: Ubuntu)  │ ─────────────> │   Local Machine  │
│ Big Buck Bunny (mp4) │                │  (Media Player)  │
└──────────────────────┘                └──────────────────┘
```

## 範例 5: 本機 Webcam → RTMP → RTMP Server → HLS → 本機瀏覽器

[我的 Github 實作](https://github.com/ChiuWeiChung/live-streaming/tree/feature/hls)

```
 ______________                           .---.     
||      *     ||                         /     \        
||            ||                         \.@-@./    
||____________||                         /`\_/`\    
|______________|                        //  _  \\   
 \\############\\                      | \     )|_  
  \      ____    \                    /`\_`>  <_/ \ 
   \_____\___\____\                   \__/'---'\__/ 
┌───────────────────┐   (RTMP)   ┌───────────────────────┐
│    Local Webcam   │ ─────────> │ (Docker: RTMP Server) │
└───────────────────┘            └───────────────────────┘
                                            │
                                            │ 
                                            │(HLS)
                                            │         .--.
                                            v         |__| .-------.
                            ┌────────────────────────┐|=.| |.-----.|
                            │      Local Machine     │|--| ||     ||
                            │Browser(http://...m3u8) │|  | |'-----'|
                            └────────────────────────┘|__|~')_____('
```


## 範例 5: IP Camer → MJPEG 格式 → 本機瀏覽器

[我的 Github 實作](https://github.com/ChiuWeiChung/live-streaming/tree/feature/ipcam-streaming)

```
  _______________                         ____________________________                                              
)=|             |     /                   | []  []  []          □ ⊖ ✕|                                              
  |  IP Camera  |====||    HTTP Protocol  |--------------------------|                                              
  |             |====||    ─────────────> | https://www.example.com  |                                              
  |             |+    \                   |--------------------------|                                                  
  ---------------                         |  +--------------------+  |                                                
       (--)                               |  |    Img Element     |  |                                              
      *    *                              |  |  (MJPEG Stream)    |  |                                              
     *      *                             |  +--------------------+  |  
    *        *                            |__________________________|  
```